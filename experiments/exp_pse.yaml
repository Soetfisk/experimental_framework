elements:

# the order in which classes are defined is not important, the FSM transitions
# are going to define what is executed and in what order.
# Elements will not be initialized if they are not in the FSM


####################################
# Initial and final states in the FSM.
####################################
 - className: EmptyState
   name: start
   timeout: 1.0

 - className: EmptyState
   name: end

####################################
# Text display elements.
####################################

 # introduction to the experiment
 - className: ScreenText
   name: IntroScreen
   plain_text: PilotData/introPilot.txt
   # some keybindings defined in a separate YAML
   config: PilotData/introScreen.yaml

 - className: ScreenText
   name: colourBlindText
   plain_text: PilotData/colourBlindText.txt
   # example defining the keybindings directly here
   keys:
    - key: escape
      callback: sendMessage
      args: ['auto']

 - className: ScreenText
   name: colourBlindProblem
   plain_text: PilotData/colourBlindProblem.txt

 - module: ScreenText
   className: ScreenText
   name: PrePilotScreen
   plain_text: PilotData/prePilot.txt
   keys:
    - key: escape
      callback: sendMessage
      args: ['auto']

# @TODO - write up intro text
 - className: ScreenText
   name: gameIntroText
   plain_text: PilotData/gameIntroText.txt
   keys:
    - key: n
      callback: sendMessage
      args: ['auto']

 - module: ScreenText
   className: ScreenText
   name: FinalScreen
   plain_text: PilotData/finalText.txt


 - className: HUDText
   name: MessageAdjustScale
   text: "Please use the keys 'w' (increase), 's' (decrease) to adjust the size of the \nmodel (parachute+robot) so it occupies exactly 5 cm on your screen. \nFor finner adjustments use 'e' and 'd' accordingly.\n\nPress the key 'n' when you have finished the adjustment"
   topLeft: [0.1, 0.2]
   keys:
    - key: n
      callback: sendMessage
      args: ['nextPressed']

 # One stop timer, can be initialized at the beginning
 - module: HUDText
   className: HUDTimer
   name: timer1
   text: "0.0"
   topLeft: [0.1, 0.08]
   hide: True

 # One stop timer, can be initialized at the beginning
 - module: HUDText
   className: HUDCountDown
   name: countDown
   text: "Get ready!"
   countDown: 10.0
   startIn: 1.0
   trigger: startGame
   topLeft: [1.0, 1.0]
   hide: False

####################################
# Forms - Data input.
####################################

 - module: DataForm
   className: ConsentForm
   name: consentForm
   config: PilotData/consentForm.yaml

 - className: ServerConfig
   name: studyServer
   serverName: 127.0.0.1
   serverPort: 2357
   keys:
    - key: c
      callback: getConfig
    - key: p
      callback: pushResults
      args: ['this is a result']


# Very custom Element, for querying for Colour Blindness
 - module: FullScreenImage
   className: ImageQuery
   name: colourBlindCheck
   imageNameStr: PilotData/colorblind/plate%d.png
#   imageStrArgs: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]
   imageStrArgs: [1,2,3]
#   imageAnswers: [12,8,6,29,57,5,3,15,74,2,6,97,45,5,7,16,73]
   imageAnswers: [12,8,6]
   images: exp range(1,39)
   scale: [0.5,0.5]
   keys:
    - key: n
      callback: nextImage
      once: false

 - module: Pilot
   className: ScreenAdjustment
   name: rescaleScreen
   modelName: "PilotData/models/plane"
   texture: "PilotData/textures/soldierRed_100.png"
   config: PilotData/screenAdjust.yaml
   # distance of the parachute from camera
   parDistCam: 250.0
   writeToGlobals:
     rescaleFactor: 12.0
   keys:
    - key: escape
      callback: sendMessage
      args: ['auto']
      once: true

 - className: Game
   name: thegame
   config: PilotData/gameConfig.yaml
   saveReplay: PilotData/run/replayLogA.txt,w
   logFile: PilotData/run/gameLogA.txt,a
   pointsToEnd: 30
   readFromGlobals:
     rescaleFactor: 12.0
   keys:
    - key: p
      callback: pauseFall
    - key: o
      callback: unPauseFall
    - key: escape
      callback: sendMessage
      args: ['auto']

 - className: DataForm
   name: UserInfo
   config: PilotData/pilotDataForm.yaml

 - className: Pilot
   name: Pilot
   pilotLog: run/pilotLog.txt,a
   config: PilotData/pilotConfig.yaml
   s_saveReplay: PilotData/run/replayLogA.txt,w
   s_logFile: PilotData/run/pilot.txt,a
   parDistCam: 250.0
   readFromGlobals:
     rescaleFactor: 12.0

 - module: DataForm
   className: DataForm
   name: PilotQuestionnaire
   config: PilotData/pilotQuestionnaire.yaml

 - module: DataForm
   className: UserQuestionnaire
   name: gameQuestions
   config: PilotData/gameQuestionnaire.yaml
   keys:
    - key: i,i-repeat
      callback: scale
      args: ['up']
    - key: k,k-repeat
      callback: scale
      args: ['down']
    - key: n
      callback: sendMessage
      args: ['auto']

transitions:
#- trans: 'start @ IntroScreen:auto'
- trans: 'IntroScreen @ consentForm:auto'
- trans: 'consentForm @ UserInfo:yesPressed'
- trans: 'consentForm @ end:noPressed'
- trans: 'UserInfo @ colourBlindText:nextPressed'
- trans: 'colourBlindText @ colourBlindCheck:auto'
- trans: 'colourBlindCheck @ colourBlindProblem:imageQueryBad'
- trans: 'colourBlindProblem @ end:auto'
# TWO STATES ACTIVATED HERE
- trans: 'colourBlindCheck @ MessageAdjustScale:imageQueryOk'
- trans: 'colourBlindCheck @ rescaleScreen:imageQueryOk'
# TWO STATES DEACTIVATE INTO ONE
- trans: 'rescaleScreen @ gameIntroText:nextPressed'
- trans: 'MessageAdjustScale @ gameIntroText:nextPressed'

- trans: 'start @ gameIntroText:auto'
- trans: 'gameIntroText @ thegame:auto'
- trans: 'gameIntroText @ countDown:auto'

- trans: 'countDown @ gameQuestions:endOfGame'
- trans: 'thegame @ gameQuestions:endOfGame'

- trans: 'gameQuestions @ PrePilotScreen:auto'
- trans: 'PrePilotScreen @ Pilot:auto'
- trans: 'Pilot @ PilotQuestionnaire: auto'

# SERVER UPLOAD INFORMATION
# - trans: 'PilotQuestionnaire @ studyServer: auto'
# STUDY SERVER UPLOAD TO FINAL SCREEN
# - trans: 'studyServer @ FinalScreen: dataSaved'
# END
# - trans: 'FinalScreen@end:auto'
